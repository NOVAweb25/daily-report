<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>سجل يومي للموظفين</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Tajawal', 'Arial', sans-serif;
      background: #121921; /* خلفية كحلي */
      color: #FFFFFF;
      padding: 20px;
    }
    .container { max-width: 900px; margin: auto; padding: 0 10px; }
    /* الشعار بدائرة بيضاء */
    .logo-wrapper {
      display: flex; justify-content: center; margin-bottom: 20px;
    }
    .logo-circle {
      width: 140px; height: 140px;
      background: #FFFFFF; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
      padding: 15px;
    }
    .logo {
      width: 100%; height: auto;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,0.2));
    }
    .date {
      text-align: center; color: #FFD166; font-size: 19px; font-weight: 600; margin-bottom: 28px;
    }
    .card {
      background: #1E3A5F; /* أزرق أعمق */
      border-radius: 16px; padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 12px 35px rgba(0,0,0,0.25);
    }
    .card h3 {
      margin: 0 0 20px; color: #FFD166;
      display: flex; justify-content: space-between; align-items: center;
      font-size: 21px; font-weight: 700;
    }
    .section {
      background: #152d4a; /* أزرق داكن */
      border-radius: 12px; padding: 18px; margin-bottom: 18px;
      border: 1px solid #2c5282; position: relative;
    }
    input, textarea {
      width: 100%; padding: 14px; margin: 9px 0;
      border: 1px solid #4a5568; border-radius: 10px;
      font-size: 16px; background: #f7fafc; color: #1a202c;
      transition: all 0.3s ease;
      resize: vertical; /* يسمح بتعديل الحجم عموديًا */
      min-height: 50px; /* للـ textarea */
    }
    input:focus, textarea:focus {
      border-color: #FFD166; outline: none;
      box-shadow: 0 0 0 3px rgba(255,209,102,0.4);
    }
    /* خانة الوقت: منتقي وقت مدمج */
    input[type="time"] {
      color: #1a202c; font-size: 16px;
      padding: 14px; border-radius: 10px;
      border: 1px solid #4a5568;
      background: #f7fafc;
      appearance: none; /* لتحسين المظهر */
    }
    input[type="time"]::-webkit-calendar-picker-indicator {
      filter: invert(0.6);
      cursor: pointer;
      background-color: #FFD166; /* لجعلها واضحة */
      padding: 5px;
      border-radius: 5px;
    }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    /* زر إضافة صف (أصفر مع توهج قوي) */
    .add-btn {
      width: 50px; height: 50px; border-radius: 50%;
      background: #FFD166; color: #121921; border: none;
      font-size: 28px; font-weight: bold; cursor: pointer;
      box-shadow: 0 0 20px rgba(255,209,102,0.7), 0 0 35px rgba(255,209,102,0.5);
      transition: all 0.3s ease; display: block; margin: 14px auto;
    }
    .add-btn:hover {
      transform: scale(1.2);
      box-shadow: 0 0 30px rgba(255,209,102,0.9), 0 0 50px rgba(255,209,102,0.7);
    }
    /* أزرار التبديل */
    .toggle {
      padding: 8px 16px; border-radius: 25px;
      font-size: 13px; font-weight: 600; cursor: pointer;
      border: none; transition: all 0.3s;
    }
    .toggle.off { background: #8B1E3F; color: white; } /* خمري */
    .toggle.on { background: #FFD166; color: #121921; } /* أصفر */
    /* زر الحذف */
    .delete-btn {
      position: absolute; top: 12px; left: 12px;
      width: 34px; height: 34px; border-radius: 50%;
      background: #8B1E3F; color: white; border: none;
      font-size: 19px; cursor: pointer;
      box-shadow: 0 3px 10px rgba(139,30,63,0.5);
      transition: 0.3s;
    }
    .delete-btn:hover { background: #6d172f; transform: scale(1.15); }
    /* زر الإرسال - أحمر كرزي */
    .submit-btn {
      background: #C8202F; color: white; padding: 18px;
      border: none; border-radius: 14px; font-size: 20px; font-weight: 700;
      cursor: pointer; width: 100%; margin-top: 30px;
      box-shadow: 0 8px 25px rgba(200,32,47,0.4);
      transition: 0.3s;
    }
    .submit-btn:hover {
      background: #a81a26;
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(200,32,47,0.5);
    }
    .hidden { display: none; }
    /* Responsive للجوال */
    @media (max-width: 600px) {
      body { padding: 10px; }
      .container { max-width: 100%; padding: 0; }
      .row { grid-template-columns: 1fr; } /* يجعل الحقول عمودية */
      .card { padding: 16px; margin-bottom: 16px; }
      .section { padding: 14px; margin-bottom: 14px; }
      input, textarea { font-size: 15px; padding: 12px; min-height: 60px; } /* أكبر للوضوح */
      .logo-circle { width: 120px; height: 120px; padding: 10px; }
      .date { font-size: 17px; margin-bottom: 20px; }
      .add-btn { width: 45px; height: 45px; font-size: 24px; margin: 10px auto; }
      .delete-btn { top: 8px; left: 8px; width: 30px; height: 30px; font-size: 16px; }
      .submit-btn { padding: 16px; font-size: 18px; }
      input[type="time"] { 
        font-size: 18px; /* أكبر للوضوح في الجوال */
        background: #f7fafc url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBkPSJNMTIgMThsLTYgLTZIM1YxMGg2bDYgNnptMCAwVjZoNHY2eiIvPjwvc3ZnPg==') no-repeat right 10px center; /* أيقونة ساعة */
        background-size: 24px;
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <!-- الشعار بدائرة بيضاء -->
    <div class="logo-wrapper">
      <div class="logo-circle">
        <img src="assets/logo.svg" alt="شعار الشركة" class="logo">
      </div>
    </div>
    <p class="date">التاريخ: <span id="today"></span></p>
    <form id="dailyForm">
      <!-- معلومات الموظف -->
      <div class="card">
        <h3>معلومات الموظف</h3>
        <input type="text" id="empName" placeholder="اسم الموظف" required />
        <input type="text" id="empPhone" placeholder="رقم الجوال" required />
      </div>
      <!-- المهام -->
      <div class="card">
        <h3>المهام
          <button type="button" class="toggle on" onclick="toggleSection('tasks', this)">إيقاف</button>
        </h3>
        <div id="tasks">
          <div class="task-section section" data-index="0">
            <button type="button" class="delete-btn" onclick="deleteSection(this)">X</button>
            <div class="row">
              <!-- منتقي الوقت الذكي -->
              <input type="time" class="time" placeholder="اختر الوقت" required />
              <input type="text" class="project" placeholder="المشروع" required />
            </div>
            <textarea class="details" placeholder="تفاصيل المهمة" required rows="3"></textarea>
            <input type="text" class="done" placeholder="نسبة الإنجاز (مثل: 80%)" required />
          </div>
          <button type="button" class="add-btn" onclick="addTask()">+</button>
        </div>
      </div>
      <!-- المصروفات -->
      <div class="card">
        <h3>المصروفات
          <button type="button" class="toggle on" onclick="toggleSection('expenses', this)">إيقاف</button>
        </h3>
        <div id="expenses">
          <div class="expense-section section" data-index="0">
            <button type="button" class="delete-btn" onclick="deleteSection(this)">X</button>
            <input type="text" class="e-project" placeholder="المشروع / الموقع" required />
            <input type="text" class="e-amount" placeholder="المبلغ" required />
            <textarea class="e-desc" placeholder="بيان الصرف" required rows="3"></textarea>
            <input type="text" class="e-to" placeholder="لمن تم الصرف" required />
          </div>
          <button type="button" class="add-btn" onclick="addExpense()">+</button>
        </div>
      </div>
      <!-- الصعوبات -->
      <div class="card">
        <h3>الصعوبات
          <button type="button" class="toggle on" onclick="toggleSection('difficulties', this)">إيقاف</button>
        </h3>
        <div id="difficulties">
          <div class="diff-section section" data-index="0">
            <button type="button" class="delete-btn" onclick="deleteSection(this)">X</button>
            <textarea class="d-issue" placeholder="الصعوبة" required rows="3"></textarea>
            <textarea class="d-need" placeholder="الاحتياج" required rows="3"></textarea>
            <textarea class="d-suggest" placeholder="الاقتراح" required rows="3"></textarea>
          </div>
          <button type="button" class="add-btn" onclick="addDiff()">+</button>
        </div>
      </div>
      <button type="submit" class="submit-btn">إرسال السجل</button>
    </form>
  </div>
  <script>
    // التاريخ ميلادي
    const today = new Date();
    document.getElementById('today').textContent = today.toLocaleDateString('en-GB'); // dd/mm/yyyy
    // حالة الأقسام
    const status = { tasks: true, expenses: true, difficulties: true };
    // تبديل ON/OFF
    function toggleSection(id, btn) {
      status[id] = !status[id];
      const container = document.getElementById(id);
      container.style.display = status[id] ? 'block' : 'none';
      btn.textContent = status[id] ? 'إيقاف' : 'تفعيل';
      btn.className = status[id] ? 'toggle on' : 'toggle off';
      container.querySelectorAll('input, textarea').forEach(i => i.required = status[id]);
    }
    // إضافة صف
    function addSection(containerId, templateClass) {
      const container = document.getElementById(containerId);
      const template = container.querySelector(`.${templateClass}`).cloneNode(true);
      const index = container.querySelectorAll(`.${templateClass}`).length;
      template.setAttribute('data-index', index);
      const inputs = template.querySelectorAll('input, textarea');
      inputs.forEach(i => { i.value = ''; i.required = status[containerId]; });
      const deleteBtn = template.querySelector('.delete-btn');
      if (deleteBtn) deleteBtn.onclick = () => deleteSection(deleteBtn);
      container.insertBefore(template, container.querySelector('.add-btn'));
    }
    function addTask() { addSection('tasks', 'task-section'); }
    function addExpense() { addSection('expenses', 'expense-section'); }
    function addDiff() { addSection('difficulties', 'diff-section'); }
    // حذف صف
    function deleteSection(btn) {
      const section = btn.parentElement;
      if (section.parentElement.querySelectorAll('.section').length > 1) {
        section.remove();
      } else {
        alert('لا يمكن حذف الصف الأول!');
      }
    }
    // تنسيق الوقت عند الإرسال (إضافة AM/PM إذا لم يكن موجودًا)
    function formatTime(timeStr) {
      if (!timeStr) return '';
      const [hours, minutes] = timeStr.split(':');
      const h = parseInt(hours);
      const period = h >= 12 ? 'PM' : 'AM';
      const displayHour = h > 12 ? h - 12 : (h === 0 ? 12 : h);
      return `${displayHour}:${minutes} ${period}`;
    }
    // الإرسال مع التحقق من الحقول
    document.getElementById('dailyForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      // التحقق من الحقول المطلوبة
      let isValid = true;
      document.querySelectorAll('input[required], textarea[required]').forEach(field => {
        if (field.value.trim() === '' && field.required) {
          isValid = false;
          field.style.borderColor = '#C8202F'; // تظليل أحمر للخطأ
        } else {
          field.style.borderColor = '#4a5568'; // إعادة اللون الافتراضي
        }
      });
      if (!isValid) {
        alert('يرجى ملء جميع الحقول المطلوبة!');
        return;
      }
      const tasks = [];
      if (status.tasks) {
        document.querySelectorAll('.task-section').forEach(sec => {
          const timeInput = sec.querySelector('.time');
          tasks.push({
            "وقت المهمة": formatTime(timeInput.value),
            "مشروع المهمة": sec.querySelector('.project').value,
            "تفاصيل المهمة": sec.querySelector('.details').value,
            "نسبة الإنجاز": sec.querySelector('.done').value
          });
        });
      }
      const expenses = [];
      if (status.expenses) {
        document.querySelectorAll('.expense-section').forEach(sec => {
          expenses.push({
            "مشروع المصروف": sec.querySelector('.e-project').value,
            "مبلغ المصروف": sec.querySelector('.e-amount').value,
            "بيان المصروف": sec.querySelector('.e-desc').value,
            "لمن تم الصرف": sec.querySelector('.e-to').value
          });
        });
      }
      const difficulties = [];
      if (status.difficulties) {
        document.querySelectorAll('.diff-section').forEach(sec => {
          difficulties.push({
            "الصعوبة": sec.querySelector('.d-issue').value,
            "الاحتياج": sec.querySelector('.d-need').value,
            "الاقتراح": sec.querySelector('.d-suggest').value
          });
        });
      }
      const maxLen = Math.max(tasks.length, expenses.length, difficulties.length);
      const finalData = [];
      for (let i = 0; i < maxLen; i++) {
        const row = {
          "التاريخ": today.toLocaleDateString('en-GB'),
          "اسم الموظف": document.getElementById('empName').value,
          "رقم الجوال": document.getElementById('empPhone').value,
        };
        if (i < tasks.length) Object.assign(row, tasks[i]);
        if (i < expenses.length) Object.assign(row, expenses[i]);
        if (i < difficulties.length) Object.assign(row, difficulties[i]);
        finalData.push(row);
      }
      const API_URL = "https://sheetdb.io/api/v1/bjlibkqajiim6"; // غيّر برابطك
      try {
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ data: finalData })
        });
        const result = await res.json();
        if (result.created >= 1) {
          alert(`تم إرسال ${finalData.length} صفوف بنجاح!`);
          location.reload();
        } else {
          alert('فشل الإرسال.');
        }
      } catch (err) {
        alert('خطأ في الاتصال.');
      }
    });
  </script>
</body>
</html>