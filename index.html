<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>سجل يومي للموظفين</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
      font-family: 'Tajawal', sans-serif; 
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); 
      padding: 20px; 
    }
    .container { max-width: 900px; margin: auto; }
    h1 { text-align: center; color: #1565c0; margin-bottom: 8px; font-size: 28px; }
    .date { text-align: center; color: #546e7a; font-size: 18px; margin-bottom: 25px; }
    
    .card { 
      background: white; border-radius: 18px; padding: 22px; 
      margin-bottom: 22px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
      border: 1px solid #e0e0e0;
    }
    .card h3 { 
      margin: 0 0 18px; color: #1e88e5; font-size: 20px; 
      display: flex; justify-content: space-between; align-items: center;
    }
    
    input { 
      width: 100%; padding: 12px 14px; margin: 8px 0; 
      border: 1px solid #ddd; border-radius: 12px; 
      font-size: 16px; transition: all 0.3s; 
    }
    input:focus { border-color: #1e88e5; outline: none; box-shadow: 0 0 0 3px rgba(30,136,229,0.15); }
    
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 8px; }
    .row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 8px; }
    .row-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 8px; }
    
    .add-btn { 
      width: 48px; height: 48px; border-radius: 50%; 
      background: #27ae60; color: white; border: none; 
      font-size: 26px; cursor: pointer; font-weight: bold;
      box-shadow: 0 5px 18px rgba(39,174,96,0.4); 
      transition: all 0.3s; margin: 15px auto; display: block;
    }
    .add-btn:hover { transform: scale(1.12); box-shadow: 0 8px 25px rgba(39,174,96,0.6); }
    
    .toggle { 
      background: #ff9800; color: white; border: none; 
      padding: 8px 16px; border-radius: 25px; 
      font-size: 13px; cursor: pointer; font-weight: 500;
    }
    .toggle.active { background: #4caf50; }
    
    .submit-btn { 
      background: #d32f2f; color: white; padding: 18px; 
      border: none; border-radius: 14px; font-size: 20px; 
      cursor: pointer; width: 100%; margin-top: 25px; 
      box-shadow: 0 8px 25px rgba(211,47,47,0.3); 
      transition: all 0.3s; font-weight: bold;
    }
    .submit-btn:hover { background: #b71c1c; transform: translateY(-3px); }
    
    .hidden { display: none; }
  </style>
</head>
<body>

  <div class="container">
    <h1>سجل يومي للموظف</h1>
    <p class="date">التاريخ: <span id="today"></span></p>

    <form id="dailyForm">

      <!-- معلومات الموظف -->
      <div class="card">
        <h3>معلومات الموظف</h3>
        <input type="text" id="empName" placeholder="اسم الموظف" required />
        <input type="text" id="empPhone" placeholder="رقم الجوال" required />
      </div>

      <!-- المهام -->
      <div class="card">
        <h3>المهام <button type="button" class="toggle active" onclick="toggleSection('tasks')">إيقاف</button></h3>
        <div id="tasks">
          <div class="task-row">
            <div class="row">
              <input type="text" class="t-time" placeholder="الوقت (مثل: 9:00-11:00)" required />
              <input type="text" class="t-project" placeholder="المشروع" required />
            </div>
            <input type="text" class="t-details" placeholder="تفاصيل المهمة" required />
            <input type="text" class="t-done" placeholder="نسبة الإنجاز (مثل: 80%)" required />
          </div>
          <button type="button" class="add-btn" onclick="addTask()">+</button>
        </div>
      </div>

      <!-- المصروفات -->
      <div class="card">
        <h3>المصروفات <button type="button" class="toggle active" onclick="toggleSection('expenses')">إيقاف</button></h3>
        <div id="expenses">
          <div class="expense-row">
            <div class="row-4">
              <input type="text" class="e-project" placeholder="المشروع / الموقع" required />
              <input type="text" class="e-amount" placeholder="المبلغ" required />
              <input type="text" class="e-desc" placeholder="بيان الصرف" required />
              <input type="text" class="e-to" placeholder="لمن تم الصرف" required />
            </div>
            <input type="text" class="e-receipt" placeholder="رابط الإيصال (اختياري)" />
          </div>
          <button type="button" class="add-btn" onclick="addExpense()">+</button>
        </div>
      </div>

      <!-- الصعوبات -->
      <div class="card">
        <h3>الصعوبات <button type="button" class="toggle active" onclick="toggleSection('difficulties')">إيقاف</button></h3>
        <div id="difficulties">
          <div class="diff-row">
            <div class="row-3">
              <input type="text" class="d-issue" placeholder="الصعوبة" required />
              <input type="text" class="d-need" placeholder="الاحتياج" required />
              <input type="text" class="d-suggest" placeholder="الاقتراح" required />
            </div>
          </div>
          <button type="button" class="add-btn" onclick="addDiff()">+</button>
        </div>
      </div>

      <button type="submit" class="submit-btn">إرسال السجل</button>
    </form>
  </div>

  <script>
    // التاريخ
    document.getElementById('today').textContent = new Date().toLocaleDateString('ar-SA');

    // حالة الأقسام
    const active = { tasks: true, expenses: true, difficulties: true };

    function toggleSection(id) {
      active[id] = !active[id];
      const section = document.getElementById(id);
      const btn = section.parentElement.querySelector('.toggle');
      section.style.display = active[id] ? 'block' : 'none';
      btn.textContent = active[id] ? 'إيقاف' : 'تفعيل';
      btn.classList.toggle('active', active[id]);
      section.querySelectorAll('input').forEach(i => i.required = active[id]);
    }

    // إضافة صفوف
    function addTask() {
      const container = document.getElementById('tasks');
      const template = container.querySelector('.task-row').cloneNode(true);
      template.querySelectorAll('input').forEach(i => { i.value = ''; i.required = active.tasks; });
      container.insertBefore(template, container.querySelector('.add-btn'));
    }

    function addExpense() {
      const container = document.getElementById('expenses');
      const template = container.querySelector('.expense-row').cloneNode(true);
      template.querySelectorAll('input').forEach(i => { i.value = ''; i.required = active.expenses; });
      container.insertBefore(template, container.querySelector('.add-btn'));
    }

    function addDiff() {
      const container = document.getElementById('difficulties');
      const template = container.querySelector('.diff-row').cloneNode(true);
      template.querySelectorAll('input').forEach(i => { i.value = ''; i.required = active.difficulties; });
      container.insertBefore(template, container.querySelector('.add-btn'));
    }

    // جمع البيانات وإرسالها
    document.getElementById('dailyForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const data = {
        "التاريخ": new Date().toLocaleDateString('ar-SA'),
        "اسم الموظف": document.getElementById('empName').value,
        "رقم الجوال": document.getElementById('empPhone').value
      };

      // المهام
      if (active.tasks) {
        document.querySelectorAll('.task-row').forEach(row => {
          data["وقت المهمة"] = row.querySelector('.t-time').value;
          data["مشروع المهمة"] = row.querySelector('.t-project').value;
          data["تفاصيل المهمة"] = row.querySelector('.t-details').value;
          data["نسبة الإنجاز"] = row.querySelector('.t-done').value;
        });
      }

      // المصروفات
      if (active.expenses) {
        document.querySelectorAll('.expense-row').forEach(row => {
          data["مشروع المصروف"] = row.querySelector('.e-project').value;
          data["مبلغ المصروف"] = row.querySelector('.e-amount').value;
          data["بيان الصرف"] = row.querySelector('.e-desc').value;
          data["لمن تم الصرف"] = row.querySelector('.e-to').value;
          data["رابط الإيصال"] = row.querySelector('.e-receipt').value;
        });
      }

      // الصعوبات
      if (active.difficulties) {
        document.querySelectorAll('.diff-row').forEach(row => {
          data["الصعوبة"] = row.querySelector('.d-issue').value;
          data["الاحتياج"] = row.querySelector('.d-need').value;
          data["الاقتراح"] = row.querySelector('.d-suggest').value;
        });
      }

      // رابط SheetDB (غيّره مرة واحدة)
      const API_URL = "https://sheetdb.io/api/v1/bjlibkqajiim6"; // ← غيّر هنا

      try {
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ data: [data] })
        });
        const result = await res.json();
        if (result.created >= 1) {
          alert('تم إرسال السجل بنجاح! سيظهر في Google Sheet خلال ثواني.');
          document.getElementById('dailyForm').reset();
        } else {
          alert('فشل الإرسال. تأكد من رابط SheetDB وصلاحيات الملف.');
        }
      } catch (err) {
        alert('خطأ في الاتصال. تأكد من الإنترنت أو الرابط.');
      }
    });
  </script>
</body>
</html>